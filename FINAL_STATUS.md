# ğŸ”´ æœ€ç»ˆçŠ¶æ€æŠ¥å‘Š

## å½“å‰é—®é¢˜æ€»ç»“

ç»è¿‡å®Œæ•´çš„åº•å±‚é‡æ„å°è¯•ï¼Œå‘ç°äº†æ ¹æœ¬çŸ›ç›¾ï¼š

### ä¸¤éš¾å›°å¢ƒ

#### æ–¹æ¡ˆAï¼šä½¿ç”¨è‡ªå®šä¹‰Worker
- âœ… **APIå®Œç¾å·¥ä½œ** (`/api/health`, `/api/categories`)  
- âœ… **D1æ•°æ®åº“æ­£å¸¸**
- âœ… **é™æ€é¡µé¢æ­£å¸¸**
- âŒ **åŠ¨æ€è·¯ç”±404** (`/articles`, `/status`)

**éƒ¨ç½²URL**: https://034a845d.smartlock-next.pages.dev

#### æ–¹æ¡ˆBï¼šä½¿ç”¨Next.js Edge Runtime
- âœ… **é™æ€é¡µé¢æ­£å¸¸**
- âŒ **æ‰€æœ‰Edge Runtimeè¿”å›500**
- âŒ **APIæ— æ³•å·¥ä½œ**
- âŒ **åŠ¨æ€è·¯ç”±å¤±è´¥**

**éƒ¨ç½²URL**: https://c9bdd01c.smartlock-next.pages.dev

---

## æ ¹æœ¬åŸå› 

**`@cloudflare/next-on-pages` (v1.13.16) ä¸ Next.js (v14.2.33) åœ¨å½“å‰ç¯å¢ƒä¸­ä¸å…¼å®¹**

### æŠ€æœ¯åˆ†æ

1. **Edge Runtimeå¯åŠ¨å¤±è´¥**
   - æ‰€æœ‰æ ‡è®°ä¸º `export const runtime = 'edge'` çš„è·¯ç”±éƒ½å´©æºƒ
   - åŒ…æ‹¬æœ€ç®€å•çš„API endpoint
   - é”™è¯¯å‘ç”Ÿåœ¨Workerè¿è¡Œæ—¶ï¼Œæ— æ³•é€šè¿‡ä»£ç ä¿®å¤

2. **getRequestContext() ä¸å¯ç”¨**
   - `@cloudflare/next-on-pages` çš„æ ¸å¿ƒAPIå¤±æ•ˆ
   - å¯¼è‡´æ— æ³•è®¿é—® `env.DB` ç­‰ç»‘å®š

3. **å…¼å®¹æ€§æ ‡å¿—å†²çª**
   - `nodejs_compat` æ—¢æ˜¯å¿…éœ€çš„åˆä¼šå¯¼è‡´å†²çª
   - ç§»é™¤ä¼šæŠ¥é”™ï¼Œä¿ç•™ä¹Ÿ500

---

## å·²å°è¯•çš„è§£å†³æ–¹æ¡ˆ

### âœ… æˆåŠŸéƒ¨åˆ†

1. **çº¯Workers API** - å®Œç¾å·¥ä½œ
   ```javascript
   export default {
     async fetch(request, env, ctx) {
       // D1æ•°æ®åº“è®¿é—®æ­£å¸¸
       const result = await env.DB.prepare('SELECT...').all()
       return new Response(JSON.stringify(result))
     }
   }
   ```

2. **é™æ€é¡µé¢** - å®Œå…¨æ­£å¸¸
   - `/` é¦–é¡µ
   - `/calculators` è®¡ç®—å™¨åˆ—è¡¨
   - `/about` å…³äºé¡µé¢  
   - æ‰€æœ‰15ä¸ªè®¡ç®—å™¨é¡µé¢

### âŒ å¤±è´¥éƒ¨åˆ†

1. **Next.jsåŠ¨æ€è·¯ç”±**
   - `/articles` - éœ€è¦Edge Runtime
   - `/articles/[category]` - éœ€è¦Edge Runtime
   - `/status` - éœ€è¦Edge Runtime

2. **åŸç”ŸAPI Routes**
   - ä½¿ç”¨Next.jsçš„ `app/api/*/route.ts` æ ¼å¼
   - å…¨éƒ¨è¿”å›500é”™è¯¯

---

## ğŸ¯ æ¨èè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå®Œå…¨è¿ç§»åˆ°Vercelï¼ˆæ¨èï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… Next.jsåŸç”Ÿå¹³å°ï¼Œ100%å…¼å®¹
- âœ… Edge Runtimeå®Œç¾æ”¯æŒ
- âœ… æ— éœ€é€‚é…å™¨
- âœ… è‡ªåŠ¨ä¼˜åŒ–å’Œéƒ¨ç½²

**æ“ä½œ**ï¼š
```bash
npm install -g vercel
vercel --prod
```

**é¢„è®¡æ—¶é—´**: 5åˆ†é’Ÿ
**æˆåŠŸç‡**: 99%

---

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨Cloudflare Workersï¼ˆä¸ç”¨Pagesï¼‰

**å®Œå…¨æ”¾å¼ƒNext.jsï¼Œä½¿ç”¨çº¯Workers + Hono**

**æ¶æ„**ï¼š
```
Workers (Hono) â†’ API + æœåŠ¡ç«¯æ¸²æŸ“
â”œâ”€â”€ /api/* - REST API
â”œâ”€â”€ /articles - SSRæ¸²æŸ“
â””â”€â”€ é™æ€èµ„æº - Workers Assets
```

**ä¼˜åŠ¿**ï¼š
- âœ… å®Œå…¨æ§åˆ¶
- âœ… åŸç”ŸCloudflareæ€§èƒ½
- âœ… D1/KV/R2å®Œç¾é›†æˆ

**åŠ£åŠ¿**ï¼š
- âŒ éœ€è¦é‡å†™æ‰€æœ‰åŠ¨æ€è·¯ç”±
- âŒ æ”¾å¼ƒNext.jsç”Ÿæ€
- âŒ å·¥ä½œé‡å¤§ï¼ˆ1-2å‘¨ï¼‰

---

### æ–¹æ¡ˆ3ï¼šæ··åˆéƒ¨ç½²

**é™æ€é¡µé¢ â†’ Cloudflare Pages**  
**åŠ¨æ€å†…å®¹ â†’ Vercel Edge Functions**

é€šè¿‡DNS/ä»£ç†ç»„åˆä¸¤è€…ï¼š
```
smartlockhub.com/* â†’ Cloudflare Pages (é™æ€)
api.smartlockhub.com/* â†’ Vercel (åŠ¨æ€API)
```

---

### æ–¹æ¡ˆ4ï¼šç­‰å¾…ä¿®å¤

ç­‰å¾… `@cloudflare/next-on-pages` æ›´æ–°ç‰ˆæœ¬ä¿®å¤å…¼å®¹æ€§é—®é¢˜ã€‚

**é£é™©**: å¯èƒ½éœ€è¦ç­‰å¾…æ•°å‘¨æˆ–æ•°æœˆ

---

## ğŸ“Š å„æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æˆæœ¬ | æ—¶é—´ | æˆåŠŸç‡ | æ€§èƒ½ | ç»´æŠ¤æ€§ |
|------|------|------|--------|------|--------|
| Vercel | å…è´¹â†’$20/æœˆ | 5åˆ†é’Ÿ | 99% | â­â­â­â­â­ | â­â­â­â­â­ |
| çº¯Workers | å…è´¹ | 1-2å‘¨ | 95% | â­â­â­â­â­ | â­â­â­ |
| æ··åˆéƒ¨ç½² | å…è´¹ | 2-3å¤© | 90% | â­â­â­â­ | â­â­â­ |
| ç­‰å¾…ä¿®å¤ | å…è´¹ | æœªçŸ¥ | 50% | - | - |

---

## ğŸ’¡ æˆ‘çš„å»ºè®®

### ç«‹å³è¡ŒåŠ¨ï¼ˆä»Šæ™šï¼‰

**éƒ¨ç½²åˆ°Vercelè·å¾—å¯ç”¨ç‰ˆæœ¬**

```bash
npm install -g vercel
vercel --prod
```

è¿™å°†åœ¨5åˆ†é’Ÿå†…ç»™ä½ ä¸€ä¸ªå®Œå…¨å·¥ä½œçš„ç½‘ç«™ã€‚

### é•¿æœŸç­–ç•¥ï¼ˆä¸‹å‘¨ï¼‰

1. **è¯„ä¼°æµé‡å’Œæˆæœ¬**
   - å¦‚æœæµé‡<10ä¸‡/æœˆ â†’ ç•™åœ¨Vercelï¼ˆå…è´¹ï¼‰
   - å¦‚æœæµé‡å¾ˆå¤§ â†’ è€ƒè™‘Workersé‡å†™

2. **åˆ†é˜¶æ®µè¿ç§»**
   - ç¬¬ä¸€é˜¶æ®µï¼šAPIè¿ç§»åˆ°Workersï¼ˆ2-3å¤©ï¼‰
   - ç¬¬äºŒé˜¶æ®µï¼šåŠ¨æ€è·¯ç”±è¿ç§»ï¼ˆ1å‘¨ï¼‰
   - ç¬¬ä¸‰é˜¶æ®µï¼šå®Œå…¨WorkersåŒ–ï¼ˆ2å‘¨ï¼‰

---

## ğŸ“ å½“å‰ä»£ç çŠ¶æ€

### å¯ç”¨éƒ¨åˆ†
- âœ… æ‰€æœ‰UIç»„ä»¶
- âœ… 58ä¸ªé™æ€é¡µé¢
- âœ… 15ä¸ªè®¡ç®—å™¨
- âœ… D1æ•°æ®åº“Schemaå’Œæ•°æ®
- âœ… è‡ªå®šä¹‰Workersæ¨¡æ¿

### ä¸å¯ç”¨éƒ¨åˆ†
- âŒ Next.js Edge Runtimeè·¯ç”±
- âŒ åŸç”ŸAPI Routes
- âŒ æœåŠ¡ç«¯æ¸²æŸ“çš„åŠ¨æ€é¡µé¢

---

## ğŸ”§ å¿«é€Ÿä¿®å¤ï¼ˆä¸´æ—¶ï¼‰

å¦‚æœå¿…é¡»ç«‹å³ä½¿ç”¨Cloudflareï¼š

### å°†åŠ¨æ€è·¯ç”±æ”¹ä¸ºé™æ€

```typescript
// app/articles/page.tsx
// ç§»é™¤: export const runtime = 'edge'
// æ·»åŠ : export const dynamic = 'force-static'

// é¢„ç”Ÿæˆæ‰€æœ‰æ–‡ç« é¡µé¢
export async function generateStaticParams() {
  return []  // è¿”å›æ‰€æœ‰æ–‡ç« çš„å‚æ•°
}
```

è¿™æ ·è‡³å°‘é¡µé¢èƒ½è®¿é—®ï¼Œä½†æ•°æ®æ˜¯æ„å»ºæ—¶çš„é™æ€æ•°æ®ã€‚

---

## ğŸ¯ æœ€ç»ˆå»ºè®®

**ç«‹å³æ‰§è¡Œ**: éƒ¨ç½²åˆ°Vercel  
**çŸ­æœŸç›®æ ‡**: è¯„ä¼°æ˜¯å¦éœ€è¦Cloudflare  
**é•¿æœŸç­–ç•¥**: å¦‚æœå¿…é¡»ç”¨Cloudflareï¼Œè®¡åˆ’Workersé‡å†™

---

**å½“å‰æœ€ä½³é€‰æ‹©**: Vercelï¼ˆNext.jsåŸç”Ÿå¹³å°ï¼‰

éƒ¨ç½²å‘½ä»¤ï¼š
```bash
npm install -g vercel
vercel --prod
```

5åˆ†é’Ÿåä½ å°†æ‹¥æœ‰ä¸€ä¸ªå®Œå…¨å·¥ä½œçš„ç½‘ç«™ã€‚

---

**æ›´æ–°æ—¶é—´**: 2025-11-23 23:50  
**çŠ¶æ€**: ğŸ”´ Cloudflare Pagesä¸å¯ç”¨ï¼Œå»ºè®®è¿ç§»åˆ°Vercel
